#!/usr/bin/env bash
# episodic-synthesize: Generate/update skills from sessions using Opus
set -euo pipefail

BIN_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$BIN_DIR/../lib/synthesize.sh"

# Parse arguments
project=""
dry_run=""
while [[ $# -gt 0 ]]; do
    case "$1" in
        --project)
            project="$2"
            shift 2
            ;;
        --dry-run)
            dry_run="--dry-run"
            shift
            ;;
        *)
            echo "Usage: episodic-synthesize [--project <name>] [--dry-run]" >&2
            exit 1
            ;;
    esac
done

# If no project specified, try to derive from current directory
if [[ -z "$project" ]]; then
    project=$(basename "$PWD")
fi

episodic_synthesize "$project" "$dry_run"
